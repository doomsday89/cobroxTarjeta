<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>confirm</title>
</head>
<body>
    <p id="msg">Espere por favor...</p>
    <script>
        const searchParams = new URLSearchParams(location.search);
        const urlAPI="http://localhost:5289/api/";
        const token="Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJSb2wiOiIyIiwiVXN1YXJpb0xvZ2luIjoibXVsdGlwYWdvcy0wNTkiLCJNdW5pY2lwaW9DbGF2ZSI6IiIsIm5iZiI6MTY4MDE5MTM2MiwiZXhwIjoxNjgwMjc3NzYyLCJpYXQiOjE2ODAxOTEzNjJ9.YS-acga6P-dDg9GD4YSWODc-FLbW7FZlSwArknXbUsg";
        const codigo=searchParams.get("codigo");
        const autorizacion = searchParams.get("autorizacion");
        const referencia = encodeURI(searchParams.get("referencia"));  
        const Municipio =referencia.substring(1,4);
        const bodyParams = { };
        const myHeaders = new Headers();
        const msg=document.getElementById('msg');

        if(codigo!=0){
            msg.innerHTML=`codigo ${codigo}. Redireccionando...`
            location.href="localhost:5500/";
        }
        else{
        myHeaders.append("Authorization", token);
        myHeaders.append("Content-Type","application/json; charset=utf-8");            

        var requestOptions = {
                    method: 'POST',
                    headers: myHeaders,
                    body:bodyParams,
                    redirect: 'follow'
                };
        fetch(`${urlAPI}Cobro/ConfirmaMultipago?ClaveCatastral=${referencia}`, requestOptions)
        .then(response => response.json())
        .then(result => {
            if(result.ok){                    
                    msg.innerHTML='Redireccionando...';
                    if(Municipio=='059')
                        location.href="htpp://www.ocosingo.gob.mx"                    
            }            
            else
                msg.innerHTML=`status: ${result.status}: ${result.title}`;
        })
        .catch(err=>{msg.innerHTML=err;});
    }
    </script>
</body>
</html>